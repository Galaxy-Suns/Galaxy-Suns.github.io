# 计算机网络

## 壹 概述

### 1.1 概述

#### 计算机网络

*计算机之间相连 网络*

* 由若干**节点***node*和连接这些节点的**链路***link*组成
* 节点可以是*计算机 集线器 交换机 路由器等*

#### 互连网

*网络相连 互连网*

* **多个网络**通过一些**路由器相互连接**, 构成一个覆盖范围更大的计算机网络
* *网络的网络*

**互联网**

*更大*

* **覆盖全球**的计算机网络

#### 当今互联网结构

**互联网服务提供者 ISP**

* 提供**接入到互联网**的服务
* 收取一定费用
* *主干 地区 本地*

*通信实例*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_1.jpg)

**互联网交换点 IXP**

* *使得连接更迅速*
* 允许两个**网络**直接相连并快速交换分组

### 1.2 互联网组成

*从工作方式上可以分为两大块*

* **边缘部分** 由所有连接在互联网上的**主机**组成, 由用户直接使用, 进行通信和资源共享 *提供资源*
* **核心部分** 由大量**网络**和连接这些网络的**路由器**组成, 为边缘部分提供服务 *提供连通性*

*互联网组成示意*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_2.jpg)


#### 边缘部分

* 处于**边缘部分**的是连接在互联网的**所有主机***host*, 也叫**端系统***end system* *不负责数据转发*
* *桌面计算机 移动计算机 服务器 其它终端设备*

**计算机之间通信**

* *主机A的某个**进程**和主机B的某个进程进行通信* *事实上是进程间的通信*
* **两种通信方式**
  * 客户/服务器方式 *Client/Server方式* C/S方式
  * 对等方式 *Peer to Peer方式* P2P方式

**C/S方式**

* 客户机的进程 *请求进程* *主动请求* **客户调试后运行** 需要知道服务器地址
* 服务器的进程 *提供进程* *被动等待* **不断运行** 不需要知道客户机地址, 可同时处理多个用户请求， *需要强大硬件和高级操作系统*
* **都可以发送和接收数据**

**P2P方式**

* 不区分服务提供方和服务请求方
* 只要都运行了*P2P软件*, 平等, 对等连接通信
* *本质仍为客户服务器模式, 只是**身份不固定**, 仍然可以一方向另一方**请求发送服务***

#### 核心部分

*互联网中最复杂的部分, 向网络边缘的主机提供**连通性***

*在其中起到核心作用的是**路由器**router*

**路由器**

* 实现**分组交换***packet switching*的关键构件, 任务是**转发收到的分组**
* **分组转发**是网络核心部分最重要的功能

#### 三种交换

**电路交换** 

* 最初1对1直接连线, n^2级别, 而后引入中间设备 **交换机**


*交换机模型*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_3.jpg)

* **交换***switching*的含义是**转接**, 在交换机内部, 将一条电话线转接到另一条电话线
* **动态**分配传输资源, *通话过程中占用通信资源, 结束后释放物理通信资源*
* **通信过程中一直*独占*通信资源**


*计算机数据的传输具有**突发性**, 通信中大量时间是没有信息传递的, 但电路传输始终占用通信资源, 因此效率低*

**分组交换**

1. 在发送端把要发送的报文, **分**成一些小的等长数据段
2. 这些数据段**添加首部(包头)** *head*后构成了分组  *首部由不同* **协议***构成*
3. 添加包头后的分组在网络*任意流浪*(**每个分组独立选择传输路径**), 节点收到后进行**存储转发**
    * 暂存收到分组
    * 检查首部
    * 查找转发表
    * 选择合适接口转发
4. 最终接收端收到后, 剥去包头, 进行**还原**

*路由器存储转发*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_4.jpg)

**优点**

* 动态分配传输带宽, **逐段占用**通信链路
* 每个分组独立选择**最合适**的转发路由
* **无需建立连接**, 就能向其它主机发送分组
* 保证可靠的网络协议, 分布式多路由的分组交换网, 不重复不丢失

**缺点**

* **排队延迟** 分组在各路由器储存转发时需要排队
* **不保证带宽** 动态分配
* **增加开销** 分组要携带*控制信息 包头*, 路由器要**暂存**分组, 维护*转发表等*

**报文交换**

* **电报交换**的方式, 分组交换就**借鉴**了一定的报文交换
* **完整报文**的存储转发, 没有分组环节
* 传输时间很长

*三种交换方式对比*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_5.jpg)

*电路交换更适用于**数据量很大**的情况*

### 1.3 计算机网络的类别

#### 计算机网络的定义

**比较公认的一种定义** 计算机网络主要由一些通用的, **可编程**的**硬件**(*包含CPU..*)**互连**而成, 而这些硬件并非专门用来实现某一特定目的(*传送数据 视频信号*), 而是用来**传送多种不同类型的数据**, 并支持广泛的日益增长的应用

*可编程代表这种硬件中一定包含**CPU***

**连通** **共享**

**通俗的定义** 是将地理位置不同的具有**独立功能**的多台计算机及其外部设备, **通过通信线路连接**起来, 在**网络操作系统, 网络管理软件及网络通信协议**的管理和协调下, 实现**资源共享**和**信息传递**的计算机系统

#### 计算机网络的类别

**按照网络的作用范围**

*从大到小*

* **广域网***WAN* 几十到几千公里的, **很大范围负责传输**(也叫*远程网*), 互联网的核心部分
* **城域网***MAN* 作用范围一般是一个城市, *核心部分靠近边缘的一些部分* 5-50公里
* **局域网** *LAN* 局限在较小的网络 (1km) *通常采用**高速通信网络*** *一个家 一个学校 一个办公室里的网*
* **个人区域网** 10m

*使用的通信协议标准很不一样*

**按照网络的使用者**

* **公用网** 交费就能使用
* **专用网** 为**特殊业务工作需要**而建立的网络

**接入网** *AN* *Access Network*

* 用来把用户接入互联网的网络 *本地接入网 居民接入网*
* 连接边缘和核心的**最后一公里**

*接入网*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_6.jpg)

### 1.4 计算机网络的性能-性能指标

*总览*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_7.jpg)

#### 速率

* **比特*bit*(和*Byte*字节区分 *bit*是一位)是信息的基本单位**(香农提出)
* 因此速率为**单位时间传输比特数** *bit/s 也叫数据率 比特率*
* *理想状态下*, **一定时间内网络信道能通过的*最大数据量***
* *由于是理想状态, 往往是理想速率或标称速率, 而非实际速率*

***注意** 1 Gbit/s = 1000 Mbit/s 带上s之后换算关系为10^3*

#### 带宽

* **原本含义** *频域* 物理意义上某个信道具有的频带宽度 *e.g.1000HZ-10000HZ*
* **计算机角度** *时域角度* 网络某信道每秒能传输多少比特 *频域带宽越高(物理), 时域带宽越高* *规划值, 而非理想值* **单位时间内网络某信道能通过的最高数据率** *bit/s*
* *同样不是实际带宽 参考*

#### 吞吐量

*机场内有多少飞机飞走, 有多少飞机飞来*

* 反映了*机场*的运送能力，规模
* **单位时间内通过某个网络(或数据, 接口)的*实际数据量*** *bit/s*
* 受到**带宽**或网络额定**速率**的限制

#### 时延

*吞吐量下降, 远低于带宽, 后续数据在排队通过, 时延变长*

* 数据(报文, 分组, 甚至比特)从网络(或链路)**一端传到另一端(*进程*)所需的时间** *单边*
* *传输 路由器的存储转发*
* 包括 **发送时延 传播时延 处理时延 排队时延**
  * **发送时延** 主机或路由器发送数据帧需要的时间, 从发送数据的**第一个比特**算起, 到**该帧最后一个比特发送完毕**所需时间 *数据帧长度 / 发送速率*
  * **传播时延** **电磁波**在信道中传输一定的距离需要花费时间 *比光速慢很多* *信道长度**决定** / 信号在信道上的传播速率**固定***
  * **处理时延** 路由器收到分组后, **处理**时所花费的时间(*查表..*)
  * **排队时延** 分组在路由器输入输出队列中**排队等待**处理和转发所经历的时延 *当通信量极大, 队列溢出, 数据丢失, 此时的排队时延为无穷大*
  * *哪一种时延占主导地位, 意味着**瓶颈**在哪里, 要具体分析*

*发生时延的事例*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_8.jpg)

*Q:高速链路时延会变小吗? A:不会, 电磁波传播速率固定, 传播时延只和距离有关 而高速链路只会**提高数据的发送速率**, 对减小发送时延有帮助, 其它时延未知*

#### 时延带宽积

* *传播时延 * 带宽* **按比特计算的链路长度** *b*
* *管道中的比特数 发送端发出, **尚未到达**接收端的比特数*
* 大小表示链路的**充分利用程度**

#### 往返时间 *RTT*

* 从**发送方发送*完*数据**到发送方**收到来自接收方的确认**, 总共经历时间 *不在发送时延阶段内*


*数据传输中的往返时间*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_9.jpg)

* **有效数据率** *数据长度 / (发送时间 + RTT) b/s* 描述本次数据发送的效率

*事实上的往返时间还要考虑到中间节点的处理排队时延等*

#### 利用率

* **信道利用率** 某信道有百分之几的**时间**是被利用的(有数据通过), 完全空闲的信道的利用率是0 **重点**
* **网络利用率** 是指全网络信道利用率的加权平均值

*信道利用率并非越高越好, 信道的利用率增大, 其引起的时延也会迅速增大*

*参考马路和堵车*

*现实规划中一般 30% - 50%*

**此外还有一些非性能指标** *费用, 质量, 可靠性等等*

### 1.5 计算机网络的体系结构

*计算机通信过程中面临诸多复杂问题, 采用**分层**的方式, 把复杂的通信问题划分成若干较小的, 比较易于研究处理的局部问题*

**抽象分层 *分解*, 统一标准 *相互理解*, 模块独立 *分工***

* ISO(国际标准化组织)提出的**OSI/RM**是使得计算机在世界范围内互连成网的**标准框架**
* 后来形成**ISO 7498国际标准(OSI七层模型)**

*七层协议的体系结构*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_10.jpg)

#### 网络的体系结构 

计算机**网络各层及其协议** *各层的标准* 的集合, 是计算机网络及其构件所应完成的**功能的精准定义**

#### 协议 

网络协议, 是为进行网络中的数据交换而建立的规则, 标准或者约定

* 三个组成要素
  * **语法** *规定数据传输的格式*, 解决**交换信息的格式问题**
  * **语义** *规定所要完成的功能*, 解决**做什么**的问题
  * **同步** *规定各种操作的顺序*, 又称为**时序**, 解决**什么时间什么条件下做什么特定操作**的问题
* 两种描述
  * 文字描述 便于人理解
  * 程序代码 便于计算机理解
* **必须遵守** *很复杂, 并非完美*

*协议存在缺陷*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_11.jpg)

*体系结构 分层的形象化描述*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_12.jpg)

#### 事实上的国际标准 *TCP/IP*

*由于各种原因OSI标准失败 定义较晚, 有些许冗余*

*按照四层模型*

* **应用层** 之前的 *应用层, 表示层, 会话层*的结合
* **运输层** 
* **互联网层** 之前的*网络层*
* **网络接口层** *数据链路层和物理层*的结合

*有很多不足*

*因为**数据链路层和物理层**是很重要的独立部分, 在讲述原理时分层为五层*

*本课程的核心内容即为五层体系结构模型从底层到上层进行*

#### 应用层 

* **任务** 通过应用进程间的交互来完成特定网络应用
* **协议** 应用进程间通信和交互的规则 *http https等*
* 应用层交互的数据单元称为报文*message*
* *为用户服务*

#### 运输层

*重要*

* **任务** 负责向两台主机中**进程之间**的通信提供通用的数据传输服务
* 有**复用和分用功能**
* **关键协议** 
  * **传输控制协议** *TCP* 提供面向连接的可靠数据传输服务
  * **用户数据报协议** *UDP* 提供无连接的尽最大努力数据传输服务 

#### 网络层

*重要*

* 为分组交换网上的**不同主机**提供通信服务
* 具体任务
  * **路由选择** 通过一定算法, 在互联网中的每一个路由器上, 生成一个用来转发分组的转发表
  * **转发** 每一个路由器在接收到一个分组时, 要依据转发表中指明的路径把分组转发到下一个路由器
* 网络协议IP和路由协议
* 传输单位 IP数据报

#### 数据链路层 

* **任务** 实现两个**相邻节点之间的可靠通信**
* 传输单位 帧
* 在相邻节点的链路上传送帧
* 差错检验

#### 物理层

* **任务** 实现**比特** *0 1* 的传输
* 确定连接电缆的插头应当有多少根引脚, 以及各引脚如何连接
* 传输介质在物理层之下

*数据传输实例*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_13.jpg)

#### 实体, 协议, 服务, 服务访问点

**实体** 表示任何可发送或接收信息的硬件或软件进程

**协议** 控制两个**对等实体**进行通信的规则的集合 *水平*

**服务** 在协议的控制下, 两个对等实体间的通信使得**本层能够向上一层提供服务**。 要实现本层协议, **还需要使用下一层提供的服务** *垂直*

**服务访问点** *SAP* 同一系统**相邻两层**的实体进行**交互的地方** *逻辑接口*

*每一层都认为在靠本层的协议和对等实体直接交流*

## 贰 物理层

---

### 2.1 基本概念

**位置** 网络体系结构的最底层 *不是具体传输媒体, 也不是链接计算机的具体物理设备*

#### 功能  

在连接计算机的传输媒体上**传输数据比特流**

* 数据链路层将比特流传送给物理层
* 物理层**将比特流**按照传输媒体的需要进行**编码**
* 将信号通过传输媒体传输到下一节的物理层 *交给传输媒体*

#### 作用 

尽可能**屏蔽掉不同传输媒体和通信手段的差异**

* 为数据链路层提供一个统一的数据传输服务

*用于物理层的协议也称为物理层的**规程***

**主要任务** 确定与传输媒体的**接口**有关的一些特性

#### DTE/DCE

*DTE和DCE*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_14.jpg)

*物理层协议是DTE和DCE间的约定, 规定了标准化的DTE/DCE具有的特性*

#### DTE/DCE的4种特性

* **机械特性** 指明接口所用的接线器的形状和尺寸, 引线数目和排列, 固定和锁定装置等 *形状外观*
* **电气特性** 指明在接口电缆的各条线的电气连接及有关电路特性, 例如 *电压范围, 阻抗, 传输速率*
* **功能特性** 指明某条线上出现的某一电平的电压的意义, 定义**接线器的每一引脚(针, Pin)的作用** 
* **过程特性** 指明对于不同功能的各种可能事件的出现顺序

### 2.2 数据通信的基本知识

**主要内容** 研究**信号**在通信**信道**上传输时的**数学表示及其所受到的限制** *深入 通信原理*

**傅里叶分析** 

* 网络通信中, 信息是以电磁信号(简称信号)的形式传输
* 电磁信号是时间的函数(时域观), 也可以表示成频率的函数
* 对于理解数据传输, 信号的频域观比时域观更重要

**时域观**

* 时间函数的角度, 电磁信号分为数字信号和模拟信号

**频域观**

* 当一个信号的所有频率成分是某一个频率的整数倍时, 该频率称为基本频率
* 信号的周期等于基本频率的周期

*了解*

#### 数据传输系统的模型

* **三大部分** 源系统(发送端, 发送方) 传输系统(传输网络) 目的系统(接收端, 接收方)

*数据传输模型*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_15.jpg)

#### 数据通信常用术语

**通信** 源点和终点之间传递信息或消息 *信息和消息要区分*

* **消息是信息的载体** 如文字，图像，语音等，只是信息的载体

**数据** 对某一事实不经解释, 并赋予一定含义的数字, 字母, 文字等符号及其组合的原始表达, **是运送消息的实体** *分为数字数据和模拟数据*

**信号** 是**消息的载体** *电信号, 光信号* *分为数字信号和模拟信号*

**信道** 信号传输的通道(传输媒介) *逻辑信道*

* 按照数据信号在信道上的传送方向与时间的关系, 分为三种
  * **单向通信**(单工通信) 只能有一个方向的通信, 没有反方向的交互
  * **双向交替通信**(半双工通信) 通信的双方可以相互交替发送信息, 但不能同时发送
  * **双向同时通信**(全双工通信) 通信的双方可以同时发送, 接收信息

**基带信号**(基本频率信号)

* 信源发出的没有经过调制的原始信号(A/D)
* 包含较多**低频**成分, 甚至包含直流部分

**调制** 让信号可以在相应信道中传输

* **基带调制** **编码*coding*** 仅对基带信号的波形进行变换, 把数字信号转换为另一种形式的**数字信号**, 例如不同电压表示0 1 *D* *编码*
* **带通调制** 使用载波*carrier*进行调制, 把基带信号频率范围搬移到较高频段, 并**转换为模拟信号**。经过载波调制后的信号称为**带通信号**(即仅在一定频率范围内能够通过信号) *A* *调制*

*通信中各术语的联系*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_16.jpg)

*Q:信道的速率?如何编码?如何调制?*

#### 常用编码方式

* **不归零制** 正电平代表1, 负电平代表0 *存在问题如 010和 001100不易区分*
* **归零制** 正脉冲代表1, 负脉冲代表0 *脉冲结束后归0* 
* **曼彻斯特** 利用跳变方向 下降沿代表1 上升沿代表0
* **差分曼彻斯特** 下一个比特是0, 边界跳变, 下一个比特是1, 边界不跳变

*四种数字信号编码方式*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_17.jpg)


*曼彻斯特和差分曼彻斯特产生信号频率比不归零制高, 具有自同步能力*

#### 基本的带通调制方法

*许多信道不能传输低频成分和直流成分, 因此需要**调制***

* **调幅** 0和1用不同幅度波形表示
* **调频** 0和1用不同频率波形表示
* **调相** 0和1用不同相位波形表示

*三种调制方式*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_18.jpg)


**码元** 使用时域的波形表示**数字信号**时, 代表不同离散数值的基本波形

* 使用二进制时, 只有两种不同码元 0 1
* **1码元可以携带多个比特的信息量** *增加码元离散状态*
* 当码元的离散状态有M个时, 此时码元称为M进制码元

*不同进制码*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_19.jpg)


#### 信道的极限容量

*信号在经过**实际信道**后会发生失真, 可能无法识别*

*种种原因 干扰 码元的频率 信噪比*

**信道能通过的频率范围**

**理想状况**

* **奈氏准则** 
  * 带宽为W(HZ) *频率意义的带宽* 的***理想*低通信道**中 *无噪声, 带宽受限*
  * 码元传输的**最高速率** = 2W (码元/秒)
  * 因此过于高频的分量往往不能通过信道, 会出现**码间串扰** *接收端收到的信号波形失去了码元之间的清晰界限*

  * v进制码元的情况下, 理想低通信道下的**极限数据传输率**C=2Wlog2(v) b/s *2W后面的值表示一个码元包含几个信息*


**非理想状况**

* 主要受**信噪比**的影响 信噪比=10log10(S/N) dB
* **香农公式** 用信息论的理论推导出了**带宽受限** *W有上限* 且**有高斯白噪声干扰**的信道的**极限, 无差错**的信息传输速率
  * C=Wlog2(1 + S/N)
  * *C 信道的极限信息传输速率*
  * *w 信道的带宽 Hz*
  * *S 信道内所传信号的平均功率*
  * *N 信道内部的高斯噪声功率*
  * **信道的带宽或信道中的信噪比** *S/N* **越大, 则信息的极限传输速率越大**
* *只要信息传输速率低于信道的极限信息传输速率, 就一定可以找到某种方法来实现无差错的传输*

**对比奈氏准则和香农公式**

* 前者**激励**工程人员不断提高*W*和*V*使得理想情况下极限信息传输速率更高
* 后者**告诫**工程人员提高*V*引起的极限信息传输速率不能突破**香农公式**计算出的实际极限信息传输速率 *v的提神引起信噪比的下降*

### 2.3 物理层下面的传输媒体

#### 导引型传输媒体

*电磁波被引导沿着固体媒体传播*

*传输介质的带宽(频率)*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_20.jpg)

* 由图可见**光纤**的频率最高, 由**奈氏准则和香农公式**, 信号传输速率也最高 *遥遥领先于其他介质*

**双绞线** *网线*

* 最古老而最常用的传输媒介
* 两根相互绝缘的铜导线并排放在一起, 然后用**规则**(一定的密度)的方法绞合*twist*起来构成双绞线
* **绞合度越高, 可用的数据传输率越高**
* 无屏蔽双绞线 *UTP*
  * 无屏蔽层
  * 较便宜
* 屏蔽双绞线 *STP*
  * 带屏蔽层
  * 有接地线
  * *信号保密上要好*  
* 传输距离最高100米

*两种双绞线*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_21.jpg)


**同轴电缆**

* 由内导体铜制芯线, 绝缘层, 网状外导体屏蔽层, 保护外层组成
* 很好的抗干扰性, 传输距离高于100米, 广泛用于传输较高速率的数据(光纤广泛运用前)
* 远距离不如光纤
* 近距离不如双绞线

**光缆**

* 光纤是光纤通信的传输媒体, 通过传递光脉冲进行通信
* 传输带宽远远大于其他各种媒体的带宽
* **发送端** 要有**无源**光, 在电脉冲的作用下能产生出光脉冲
* **接收端** 要有**光检测器**, 检测光脉uangxian

*光纤的保护与光缆*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_22.jpg)

#### 非导引型传输媒体

*自由空间 也就是**无线传输***

**微波**

* 在空间中主要**直线传输** *由于地球是圆的, 所以地球表面的传输距离受限，50km左右，有一定高度的天线塔可增到100km*
* 也可以采用卫星接力的方式传递

*两种微波接力*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_23.jpg)

### 2.4 信道复用技术

*信道的资源有限, 网络中多对用户往往利用相同信道资源传输信息, 而不同信号在同一信道中传输会产生严重的相互干扰, 导致失败*

**多路复用技术**

* 把多个信号组合在一条物理信道上进行传输, 使得多个计算机或终端设备共享信道资源, 提高信道利用率
* 允许用户使用一个共享信道通信, 提高利用率

*多路复用图示*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_24.jpg)


#### 频分复用 *FDM*

* 所有用户在相同时间内占用不同的**带宽**(频带)资源
* 子信道传输的信号以并行方式工作
* 充分利用带宽, 效率高, 易实现
* 可以让更多用户轮流使用N个频带, 称为**频分多址接入** *FDMA* *将频带复用和时间复用结合*

#### 时分复用 *TDM*

* 每个人轮流占用频带一段时间
* 一个周期称为一个**TDM帧** *125μs*
* 可以让更多用户**轮流使用**这N个时隙, 称为**时分多址接入** *TDMA*
* *由于计算机数据有突发性, 时分复用导致利用率不高*

#### 统计时分复用 *STDM*

* *为了尽量使得时分复用产生的浪费小一些*
* 在a发送之后, 检测b是否发送数据, 没有发送, 跳过b, 检测c
* **按需动态分配**时隙

#### 波分复用 *WDM*

* *光的频分复用* 分为不同波长(频段)

#### 码分复用 *CDM*

* 各用户可以同样时间使用同样频带进行通信
* 各用户使用经过**特殊挑选的不同码型**, 因此不会干扰
* 不同地址用户通过码分复用共享同一信道, 称为**码分多址** *CDMA*
* **码片**
  * 为每一个站指派一个**唯一的**m bit码片序列 
  ...

## 叁 数据链路层

---

### 3.1 基本概念

*物理层解决了相邻节点透明传输比特的问题*

#### 数据链路层的意义

* 如何在一长串比特流中找到分组的起点和终点？
* 线路上有多个设备的时候比特流该由谁接收？
* 比特传输错误怎么办？

**封装成帧 透明传输 差错控制**

#### 数据链路层

* 链路指结点间的**物理通道**
* 数据链路是节点间的**逻辑通道**, 把实现控制数据传输的协议的硬件与软件加在链路, **链路+协议**
* **数据链路层** 负责通过一条链路从一个节点向物理链路**直接相连**的相邻节点传送**帧**
* **帧** 数据链路层协议数据单元, 封装网络层的数据报 *分组*

*数据链路层认为自己在直接和其他节点的数据链路层传输帧, 不必考虑物理层实现比特传输的细节*

*协议栈的角度 数据链路层在工作*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_25.jpg)

#### 数据链路层的信道类型

* 点对点信道 *常用在核心部分的骨干链路*
* 广播信道 *一对多*
* 通信双方的信道使用形式不同 会相应有不同控制协议

#### 封装成帧

* 在一段数据的前后分别添加首部和尾部, 构成一个帧
* 首尾部的一个重要作用是**确定帧的界限**
* 将比特率划分成**帧**的主要目的是**检测和纠正物理层在比特传输中可能存在的错误**

*封装成帧*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_26.jpg)

**最大传送单元MTU** 规定了所能传送帧的数据部分长度上限

*那么如何标识一个帧的开始？帧头和帧尾如何选择？定界符出现在数据部分如何处理？*

**成帧方式**

* 字节计数法 
  * 定界符指示了本帧有多少个字节 
  * 计数字节如果错误会导致一连串帧错误
* 带**字节**填充的定界符法 *多用*
  * 用固定的控制字符*SOH*表示帧的开始, *EOT*表示帧的结束
  * 定界符出现在数据部分会出现错误识别开始/结束符 
* 带**比特**填充的定界符法
  * 与上述类似
* 物理层编码违例

#### 透明传输

**透明** 某个实际事物看起来不存在

* 指无论什么样的比特组合的数据, 都能**没有差错**地在数据链路层传递

**发送方采用字节/字符填充**

* 发送方在数据中会被错认为*SOH/ESC/EOT*的数据前加上特殊标记*ESC*
* 接收方**逐个字节检查**, 在遇到特殊符号*ESC*时, 去掉*ESC*,并且把接下来的数据认做正常数据

*ESC保证透明传输*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_27.jpg)

#### 差错控制

*噪声会导致数据在传输过程中可能产生错误*

* 传输错误的比特占比为**误码率***BER* 和信噪比有关
* **纠错码** 错误发生频繁的信道 如无线链路
* **检错码** *有错误就丢* 误码率低的信道上, 如光纤链路 （未来高层会再发一次）
  * **循环冗余校验***CRC*
  * 在原始数据后加上n位冗余码
  * 可以确保接受的帧无比特差错
  * 但不能保证**无传输差错**(可靠传输), 比如帧的顺序, 帧的数量 *帧丢失, 帧重复, 帧失序* *需要更高层 帧编号, 确认, 重传等*

*检错码工作原理(简化)*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_28.jpg)

### 3.2 点对点协议 PPP

PPP *目前**数据链路层**使用最广泛的**点对点**协议*

#### PPP 协议的组成

* 一种将**IP数据报** *封装* 到同步/异步**串行**链路的方法 
* **链路控制协议** *LCP*
  * 建立, 配置和测试数据链路的链路控制协议 *逻辑上*, 通信双方可协商一些选项, 最重要的功能之一是**身份验证** *协商一些共同使用的头部字段 一些资源..*
* **网络控制协议** *NCP*
  * 其中每一种协议支持一种不同的网络层协议, 如 IP, OSI的网络层, DECnet, AppleTalk等 *支持不同的网络层协议*

*PPP帧*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_29.jpg)


#### PPP 透明传输

* PPP协议用在**异步传输**时, 使用**字节填充法** *在遇到特殊符, 前面加ESC*
* PPP协议用在**同步传输**链路时, 采用**零比特填充法** *遇到六个1特殊符, 在中间插入0*

**同步传输** 发一个**比特**, 收一个**比特**
**异步传输** 发一个**字节**, 收一个**字节**

*PPP协议工作过程*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_30.jpg)

### 3.3 使用广播信道的数据链路层

*一个用户发送了信息, 可以让全网的用户都收到这个信息*

#### 局域网 *LAN* 的数据链路层

**局域网的特点**

* 距离短, 用户数量有限
* **具有广播功能**, 从一个站点可很方便地访问全网
* **便于系统的扩展**和逐渐地演变, 各设备的位置可灵活调整和改变
* 提高了系统的可靠性, 可用性, 和生存性
* 共享同一信道, 如**集线器**(*这也是广播信道在城域网中的问题, 信号冲突*)

**解决信号冲突**

* **静态划分**
  * 频分复用, 时分复用, 波分复用, 码分复用..
  * 适用通信量大, 流量稳定, 用户数量少, 且数目固定 *不太符合局域网的灵活特性*
* **动态划分**
  * **随机接入** 所有用户可以随机 *受控* 发送信息 *以太网*
  * **受控接入** 用户必须服从一定的控制, 如**轮询** *polling* *轮到你发你再发, 有点像时分复用*

#### 以太网

*以太网是一种技术的名称, 并非是一种网络*

*广泛运用到局域网中*

**以太网的两个标准**

* **IEEE802.3** 数据链路层分为两个子层
  * **逻辑链路控制LLC子层** *与传输媒体无关* 
  * **媒体接入控制MAC子层** *与传输媒体有关*
* **DIX Ethernet V2** *保留MAC子层, LLC层基本忽略不计*
  * 保留的MAC层和物理层组成四层体系中的**网络接入层** *适配器(网卡)* 

**适配器的作用** 

* **转换**CPU,储存器的**并行**数据和局域网的**串行**数据
* 进行数据的缓存
* 在计算机的操作系统安装设备驱动程序
* 实现以太网协议

*网卡的作用*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_31.jpg)

* 网卡通过MAC子层中的**硬件地址**(MAC地址)通信

**以太网采取的两种重要措施**

* **不必先建立连接**就可以直接发送数据 *效率高*
  * 对发送帧不进行编号, 也不要求对方发回确认 *不需要可靠传输 由更高层决定*
* 发送的数据都使用曼彻斯特编码, 便于同步

#### 总线型以太网

*以太网的最初模式*

* 很多计算机连接在同一根**总线**
* 易于实现**广播通信**, 简单, 可靠

**在总线型以太网实现一对一通信**

* 将接受站的**硬件地址**写入**帧首部**中的目的地址字段中, 仅当数据帧中的**目的地址与适配器硬件地址一致时**, 才能接收这个数据帧

*广播网络中的一对一通信*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_32.jpg)

*多个用户同时发送数据会出现数据相撞的情况, 会出现什么呢? 如何解决? **冲突, 碰撞***

**要实现*动态媒体接入*控制**

#### CSMA/CD协议 载波监听多点接入/碰撞检测

* **多点接入** 说明这是总线型网络。许多计算机以多点接入的方式连接在一根总线
* **载波监听** **边发送电波, 边监听信道** 在数据发送前和发送时, 每个站都必须**不停检测信道, 防止冲撞**
* **碰撞检测** 适配器**边发送数据, 边检测信道上的信号电压的变化情况**。电压摆动值超过一定门限值, 认为至少两个站同时发送数据, 表明产生了碰撞。

*既然已经进行了载波监听, 为什么还要进行碰撞检测?*

*信号有传播时延, 监听信道空闲, 但信道可能并非真正空闲*

**检测碰撞后**

* 适配器停止发送
* 等待一段随机时间后再重新发送

*根据一些**争用期**,**退避**机制的计算(后续补充学习), 以太网的**前64字节**没有发生冲突, 则此时所有站点都会监听到信道正在占用的信号, 后续不会发生冲突*

* 以太网规定了**最短有效帧长为64字节**, 长度小于64字节的帧都是由于冲突而异常终止的无效帧, 应当丢弃。

**CSMA/CD协议的一些特性**

* 不能进行全双工通信, 而是**半双工通信**
* 每个站在发送数据的一小段时间内, 存在**碰撞的可能性**
* 这种**不确定性**使得以太网的**平均通信量远小于**以太网**最高数据率**

*先听后发, 边听边发, 冲突停止, 延迟重发*

#### 采用集线器的星型拓扑以太网

星型拓扑的中心 **集线器** *可靠性（规定条件下）非常高*

*中心设备出现问题, 整个局域网会出现问题*

*星型拓扑的以太网*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_33.jpg)

**集线器以太网的特点**

* 形态发生变化, 但是共享总线的本质没有解决, **逻辑上依然是一个总线网**
* 仍然**共享信道**, 各工作站使用的仍然是*CSMA/CD协议*, 共享**逻辑总线**
* **工作在物理层**
* 采用了专门芯片, 减少了干扰和衰减

#### 以太网的信道利用率(后续补充学习)

*当以太网的用户数量越来越高, 数据碰撞率也随之变高, 利用率越来越低*

#### 以太网的MAC层

**硬件地址** *物理地址 MAC地址*

* 用于广播信道中进行1对1通信
* 每一台计算机***固化*在适配器中的ROM中的地址**
* **每一个适配器有一个MAC地址**, 相当与它的标识符, 和其所处的**位置无关**
* 局域网上的**每一个接口都有一个MAC地址** *每个网卡绑定一个MAC地址, 每个网卡提供一个接口, 故每个接口绑定一个MAC地址*
* *除非更换网卡(适配器), 否则计算机的MAC地址不会变*

*MAC地址的组成*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_34.jpg)

**MAC地址分类**

* **单站地址** *分给某一个接口* I/G位 = 0
* **组地址** *分给一些接口* I/G位 = 1 用来多播, 只能作为目的地址使用
* **广播地址** *分给所有人* 所有48位都为, 只能作为目的地址使用


*适配器每收到一个MAC帧,先用硬件检查帧中的MAC地址, 如果是**发往本站**的收下, 否则丢弃* 

*以太网 V2帧格式*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_35.jpg)

### 3.4 扩展以太网

#### 在物理层扩展以太网

*更大的覆盖距离? 更多用户加入?*

*仍然是一个网络*

* **改变物理层下的传输介质** 如光纤, 延长距离
* **使用集线器*Hub*扩展** 星形连接
* **级联** *但是冲突域会更大*

*多个局域网通过集线器级联组成更大局域网*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_36.jpg)

*解决冲突？ 不共享总线*

#### 在数据链路层扩展以太网

* 早期使用**网桥**, 现在使用**以太网交换机**

**网桥** *交换机的前身*

* 网桥连接后的冲突域仍然是**各自独立的冲突域**
* 网桥的接口实现了**全双工**, 因此解决了共享总线的问题
* 通过**转发表**实现向特定接口发送信息

*网桥的转发机制*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_37.jpg)

* 如果目的站MAC地址和出发站MAC地址在**同一接口**, 证明在同一冲突域, 集线器会自动发给目的站, 因此**网桥不做处理**
* 如果在**不同接口**, 则由网桥传播给相应接口的集线器

**以太网交换机** 

* 本质为多接口的网桥
* 每一个接口都直接与一台主机或另一个以太网交换律相连, 并且一般工作在**全双工**方式
* 具有**并行性** 每一个端口和连接到端口的主机形成了一个碰撞域

*交换机模型*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_38.jpg)

**以太网交换机的特点**

* 接口有存储器
* **即插即用**, 内部的**帧交换表**(地址表), 通过**自学习算法**自动逐步建立起来
* 有专用的交换结构芯片, 用硬件转发, 转发速率比**使用软件转发的网桥**快得多
* 每个接口用户独享带宽, 增加了总容量

*交换机的自学习 通过发送原地址实现*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_39.jpg)

*两个交换机(或更复杂)形成回路? 会发生广播风暴:同一个包在不断的循环发送接收，使网络性能急剧降低*

**广播风暴解决方案**

*消除环路*

* **生成树协议** *STP* 不改变实际网络的拓扑结构, 在**逻辑上**切断某些链路, 使得从一台主机到所有其他主机的路径是**无环路的树状结构** *收敛时间 从开始到起作用的时间* *生成树协议的收敛时间50-60s*

#### 虚拟局域网

**以太网的主要问题**

* 广播风暴
* 安全问题 *如用欺诈地址形成广播风暴, 阻止以太网的正常工作*
* 管理困难 *权限*

**广播域**

* 一个网络中任意一台设备发出的广播通信都能被该部分网络中的所有其它设备所接收
* **一个以太网是一个广播域**

**虚拟局域网** *VLAN*

* 是由一些局域网网段构成的**与物理位置无关的逻辑组**, 这些网段有某些共同的需求。每一个VLAN帧都有一个明确的标识符, 指明发送这个帧的计算机属于哪个VLAN
* 是局域网提供的一种服务, 不是一种新型的局域网

*虚拟局域网图示*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_40.jpg)


*每个VLAN是一个广播域*

*数据链路层的一种安全手段*

### 3.5 高速以太网

#### 快速以太网

*Ethernet 10M*

*Fast Ethernet*

* 100-1000M

**特点**

* 最短帧长不变 *64B*
* 帧间间隔从原来的9.6μs到0.96μs

#### 吉比特以太网

* 1 Gbit/s = 1000 bits/s
* **允许在全双工和半双工工作** 半双工用*CSMA/CD协议*

#### 10吉比特以太网

* 只使用**光纤**作为传输媒体
* 只工作在**全双工方式**

*工作范围已经扩大到城域网和广域网, 实现了**端到端**的以太网传输*

## 肆 网络层

---

*怎么把千千万万个局域网连接成一个互联网, 进行通信呢*

### 4.1 网络层提供的两种服务

**为什么要网络层**

* *数据链路层解决了同一局域网计算机间帧的传输问题, 但没有解决**异构网络之间的连接和资源共享**问题*
* **跨局域网连接和资源共享**
* 互联网中主机标识问题
* 互联网中主机间路由选择问题 *最佳路径*
* 互联网中数据转发问题 *分组转发*
* ...

*网络层要不要解决**可靠传输**?*

网络层是否要提供面向连接的服务? 还是无连接的服务?

可靠交付有**网络负责**还是**端系统负责**?

* 观点一: 网络层负责**可靠交付**, 采取面向连接的通信方式, 通信前建立虚电路, 预留此次通信需要的资源, 双方沿着这条逻辑连接按照**存储转发**的方式传送分组, 通信结束释放虚电路。 使用**可靠传输**的网络协议, 分组无差错按顺序到达终点, 不重不漏 *链路任何一个环节仍有可能失效, 会导致数据丢失*
* 观点二: 网络层尽可能简单, 向其上层只提供**灵活的, 无连接的, 尽最大努力交付的数据报服务**。 无需先建立连接, 每个分组独立发送, 不编号, 不承诺质量服务。**可靠交付交给更高层**

*网络层的数据报服务*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_41.jpg)


### 4.2 网络协议 IP


#### 虚拟互连网络

*网络类型等不同它们的连接会导致很多问题, 比如如何寻址? 分组长度不同?等等*

* 使用相同网络?
  * 没有一种单一的网络能够适应所有用户的需求 
* 使用**中间设备**?
  * 可以满足不同需求, 实用

物理层的中间设备 **集线器**
数据链路层的中间设备 **网桥， 交换机** 

*下两层的中间设备属于转发器, 扩大了网络, 但仍为同一网络*

网络层 **路由器** *router* 

* 连接不同网络
* 依靠 **网络协议IP** 工作

*互联网上的主机进行通信时, 像是在一个网络上通信, 看不见各具体网络的异构细节 **透明***

*网络传输模型*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_42.jpg)


#### IP数据报的组成

* 分为首部和数据部分
* **首部的组成** 
  * 版本 IPv4协议报头 0010  （4）
  * 首部长度 *来了解可变部分的长度* *最多可以表示到60个字节, 也就是除去20B的固定部分,**可变部分的长度不超过40字节***
  * 区分服务 *未广泛使用*
  * 总长度 *结合首部长度, 即可知道数据部分的长度* *最多可表示65535字节， 但ip数据报的长度不会达到这个长度, 由于数据链路层**MTU**限制* *路由器根据不同网络的数据链路层的限制, 会对数据报继续拆* ***如何拆?如何组合?***
  * 标识 所有分片具有相同标识 *知道从哪个最初数据报分出来的*
  * 标志 **保留 DF MF** 保留位没有作用, MF位为1表示后续还有更多分组分片, 0表示后续没有更多的分组分片。 DF位为1表示当前没有分片, 我就是一个整体, 为0表示有分片, 再看MF。 **当前分片的状态**
  * 片偏移 *是在分片分出的第几位* 离头有多远
  * 生存时间 *指示**数据报在网络中可通过的路由器数的最大值*** *防止了数据在网络层不停传输下去*
  * 协议 *指示数据部分要交给哪个进程* **给上层的哪个协议进行处理**
  * 首部校验和 *对首部进行校验*
  * 原地址 **一个接口有一个IP地址**
  * 目的地址
  * 可变字段 *用的很少*
  * 填充

*IP数据报的结构*
![图床异常](https://gitee.com/sun-shiboxy/my_study/raw/markdown/MDImgs/networks_43.jpg)

#### IP地址

* IP地址就是给每个连接在互联网上的主机或路由器的**每一个接口**分配一个**全球唯一的标识**
* 32位的二进制地址, 理论上有2^32个 *约43亿 不够现在的需求*
* 采用2级结构 (<网络号>,<主机号>) **网络号指明了不同网络** **主机号指明同一网络的不同主机**
* 